(function(c){function a(d){return"[id="+d.attr("id")+"][name="+d.attr("name")+"]";}c.fn.sisyphus=function(f){var e=c.map(this,function(g){return a(c(g));}).join();var d=Sisyphus.getInstance(e);d.protect(this,f);return d;};var b={};b.isAvailable=function(){if(typeof c.jStorage==="object"){return true;}try{return localStorage.getItem;}catch(d){return false;}};b.set=function(d,f){if(typeof c.jStorage==="object"){c.jStorage.set(d,f+"");}else{try{localStorage.setItem(d,f+"");}catch(g){}}};b.get=function(e){if(typeof c.jStorage==="object"){var d=c.jStorage.get(e);return d?d.toString():d;}else{return localStorage.getItem(e);}};b.remove=function(d){if(typeof c.jStorage==="object"){c.jStorage.deleteKey(d);}else{localStorage.removeItem(d);}};Sisyphus=(function(){var f={instantiated:[],started:[]};var d=window.CKEDITOR;function e(){return{setInstanceIdentifier:function(g){this.identifier=g;},getInstanceIdentifier:function(){return this.identifier;},setInitialOptions:function(g){var h={excludeFields:[],customKeySuffix:"",locationBased:false,timeout:0,autoRelease:true,onBeforeSave:function(){},onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||c.extend(h,g);this.browserStorage=b;},setOptions:function(g){this.options=this.options||this.setInitialOptions(g);this.options=c.extend(this.options,g);},protect:function(g,i){this.setOptions(i);g=g||{};var h=this;this.targets=this.targets||[];if(h.options.name){this.href=h.options.name;}else{this.href=location.hostname+location.pathname+location.search+location.hash;}this.targets=c.merge(this.targets,g);this.targets=c.unique(this.targets);this.targets=c(this.targets);if(!this.browserStorage.isAvailable()){return false;}var j=h.options.onBeforeRestore.call(h);if(j===undefined||j){h.restoreAllData();}if(this.options.autoRelease){h.bindReleaseData();}if(!f.started[this.getInstanceIdentifier()]){if(h.isCKEditorPresent()){var k=setInterval(function(){if(d.isLoaded){clearInterval(k);h.bindSaveData();f.started[h.getInstanceIdentifier()]=true;}},100);}else{h.bindSaveData();f.started[h.getInstanceIdentifier()]=true;}}},isCKEditorPresent:function(){if(this.isCKEditorExists()){d.isLoaded=false;d.on("instanceReady",function(){d.isLoaded=true;});return true;}else{return false;}},isCKEditorExists:function(){return typeof d!=="undefined";},findFieldsToProtect:function(g){return g.find(":input").not(":submit").not(":reset").not(":button").not(":file").not(":password").not(":disabled").not("[readonly]");},bindSaveData:function(){var g=this;if(g.options.timeout){g.saveDataByTimeout();}g.targets.each(function(){var h=a(c(this));g.findFieldsToProtect(c(this)).each(function(){if(c.inArray(this,g.options.excludeFields)!==-1){return true;}var j=c(this);var i=(g.options.locationBased?g.href:"")+h+a(j)+g.options.customKeySuffix;if(j.is(":text")||j.is("textarea")){if(!g.options.timeout){g.bindSaveDataImmediately(j,i);}}g.bindSaveDataOnChange(j);});});},saveAllData:function(){var g=this;g.targets.each(function(){var h=a(c(this));var i={};g.findFieldsToProtect(c(this)).each(function(){var n=c(this);if(c.inArray(this,g.options.excludeFields)!==-1||(n.attr("name")===undefined&&n.attr("id")===undefined)){return true;}var m=(g.options.locationBased?g.href:"")+h+a(n)+g.options.customKeySuffix;var l=n.val();if(n.is(":checkbox")){var j=n.attr("name");if(j!==undefined&&j.indexOf("[")!==-1){if(i[j]===true){return;}l=[];c("[name='"+j+"']:checked").each(function(){l.push(c(this).val());});i[j]=true;}else{l=n.is(":checked");}g.saveToBrowserStorage(m,l,false);}else{if(n.is(":radio")){if(n.is(":checked")){l=n.val();g.saveToBrowserStorage(m,l,false);}}else{if(g.isCKEditorExists()){var k=d.instances[n.attr("name")]||d.instances[n.attr("id")];if(k){k.updateElement();g.saveToBrowserStorage(m,n.val(),false);}else{g.saveToBrowserStorage(m,l,false);}}else{g.saveToBrowserStorage(m,l,false);}}}});});g.options.onSave.call(g);},restoreAllData:function(){var g=this;var h=false;g.targets.each(function(){var j=c(this);var i=a(c(this));g.findFieldsToProtect(j).each(function(){if(c.inArray(this,g.options.excludeFields)!==-1){return true;}var m=c(this);var l=(g.options.locationBased?g.href:"")+i+a(m)+g.options.customKeySuffix;var k=g.browserStorage.get(l);if(k!==null){g.restoreFieldsData(m,k);h=true;}});});if(h){g.options.onRestore.call(g);}},restoreFieldsData:function(i,h){if(i.attr("name")===undefined&&i.attr("id")===undefined){return false;}var g=i.attr("name");if(i.is(":checkbox")&&h!=="false"&&(g===undefined||g.indexOf("[")===-1)){i.prop("checked",true);}else{if(i.is(":checkbox")&&h==="false"&&(g===undefined||g.indexOf("[")===-1)){i.prop("checked",false);}else{if(i.is(":radio")){if(i.val()===h){i.prop("checked",true);}}else{if(g===undefined||g.indexOf("[")===-1){i.val(h);}else{h=h.split(",");i.val(h);}}}}},bindSaveDataImmediately:function(j,i){var g=this;if("onpropertychange" in j){j.get(0).onpropertychange=function(){g.saveToBrowserStorage(i,j.val());};}else{j.get(0).oninput=function(){g.saveToBrowserStorage(i,j.val());};}if(this.isCKEditorExists()){var h=d.instances[j.attr("name")]||d.instances[j.attr("id")];if(h){h.document.on("keyup",function(){h.updateElement();g.saveToBrowserStorage(i,j.val());});}}},saveToBrowserStorage:function(j,k,h){var g=this;var i=g.options.onBeforeSave.call(g);if(i!==undefined&&i===false){return;}h=h===undefined?true:h;this.browserStorage.set(j,k);if(h&&k!==""){this.options.onSave.call(this);}},bindSaveDataOnChange:function(h){var g=this;h.change(function(){g.saveAllData();});},saveDataByTimeout:function(){var h=this;var g=h.targets;setTimeout((function(){function i(){h.saveAllData();setTimeout(i,h.options.timeout*1000);}return i;})(g),h.options.timeout*1000);},bindReleaseData:function(){var g=this;g.targets.each(function(){var i=c(this);var h=a(i);c(this).bind("submit reset",function(){g.releaseData(h,g.findFieldsToProtect(i));});});},manuallyReleaseData:function(){var g=this;g.targets.each(function(){var i=c(this);var h=a(i);g.releaseData(h,g.findFieldsToProtect(i));});},releaseData:function(j,g){var i=false;var h=this;f.started[h.getInstanceIdentifier()]=false;g.each(function(){if(c.inArray(this,h.options.excludeFields)!==-1){return true;}var l=c(this);var k=(h.options.locationBased?h.href:"")+j+a(l)+h.options.customKeySuffix;h.browserStorage.remove(k);i=true;});if(i){h.options.onRelease.call(h);}}};}return{getInstance:function(g){if(!f.instantiated[g]){f.instantiated[g]=e();f.instantiated[g].setInstanceIdentifier(g);f.instantiated[g].setInitialOptions();}if(g){return f.instantiated[g];}return f.instantiated[g];},free:function(){f={instantiated:[],started:[]};return null;},version:"1.1.2"};})();})(jQuery);